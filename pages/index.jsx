import Head from 'next/head';
import Link from 'next/link'
import React, { useEffect, useState } from 'react';
// import styles from '../styles/Home.module.css'

import dbApi from './api/dbApi'
import MovieRow from '../src/components/movie-row/MovieRow'
import '../styles/index.module.css'
import FeaturedMovie from '../src/components/featured-movie/FeaturedMovie';
import Header from '../src/components/header/Header';


export default function Home({list}) {
  
  const [movieList, setMovieList] = useState([]);

  const [featuredData, setFeaturedData] = useState(null);


  useEffect((  ) => {

    const loadAll = async () => {

    //Pegando a lista total de filmes do tmdb
    let list = await dbApi.getHomeList();
    setMovieList(list);

    //Pegando  aleatoriamente o filme em destaque(featured)
    let featuredMovie = list.filter(i=>i.slug === 'originals');
    let randomFeatured = Math.floor(Math.random() * (featuredMovie[0].items.results.length - 1))
    let featuredChosen = featuredMovie[0].items.results[randomFeatured];
    let chosenInfo = await dbApi.getMovieInfo(featuredChosen.id, 'tv');
    setFeaturedData(chosenInfo);
    
    
    }
    loadAll();
  }, []);
  
  

  
  
  return (
    <main className="body">
      <Head>
        <title>NextFlix</title>
        <meta name="description" content="Generated by create next app" />
        <link rel="icon" href="/favicon.ico" />
      </Head>

      <Header />
      
      <div className="page">

      {featuredData && <FeaturedMovie 
      item={featuredData} />}

        
          <section className="lists">
          {movieList.map( (item,key) => (

            <div>
              <MovieRow key={key} 
              
              title={item?.title} 
              items={item?.items}
            
              
              />
            </div>
          
          ))}
          </section>
          <div>
            

          <Link href="/search"><button>Buscaaaaaaaaa</button></Link>

            
          </div>
      <Link href="/about">Pagina Sobreee mimmm</Link>  
      </div>
      
      
  


      <footer>
      </footer>
    </main>
  );
}

//function for set server side render mode
export async function getServerSideProps() {

  const res = await fetch ('http://localhost:3000/api/trending');
  const json = await res.json();

  return{

    props:{
      list: json.list
    }

  }
}
